@* Views/Form/Index.cshtml *@

@{
    ViewData["Title"] = "History - Forms List";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap4.min.css">
    <style>
        .history-container {
            max-width: 1200px;
            margin: 30px auto;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
            padding: 15px 20px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        .alert {
            margin-bottom: 20px;
        }

        .table thead th {
            background-color: #f8f9fa;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                border-color: #0056b3;
            }
    </style>
}

<div class="history-container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    <div class="card">
        <div class="card-header">
            <i class="fas fa-history"></i> History
        </div>
        <div class="card-body">
            <div class="mb-3">
                <a href="@Url.Action("Create", "Form")" class="btn btn-success">
                    <i class="fas fa-plus"></i> Create New Form
                </a>
            </div>

            <table id="formsTable" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>Form Title</th>
                        <th>Created Date</th>
                        <th>Fields Count</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be loaded via AJAX -->
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap4.min.js"></script>

    <script>
        $(document).ready(function() {
            debugger;
            var table = $('#formsTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/api/FormApi/GetFormsDataTable',
                    type: 'POST',
                    contentType: 'application/json',
                    data: function(d) {
                        return JSON.stringify(d);
                    },
                    error: function(xhr, error, thrown) {
                        console.error('Error loading data:', error);
                        alert('Error loading forms data. Please try again.');
                    }
                },
                columns: [
                    { data: 'formTitle', name: 'FormTitle' },
                    { data: 'createdDate', name: 'CreatedDate' },
                    { data: 'fieldCount', name: 'FieldCount', orderable: false, searchable: false },
                    { data: 'actions', name: 'Actions', orderable: false, searchable: false }
                ],
                order: [[1, 'desc']],
                pageLength: 10,
                lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
                language: {
                    processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span>',
                    emptyTable: 'No forms available',
                    zeroRecords: 'No matching forms found'
                }
            });
        });
    </script>
}